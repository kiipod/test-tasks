# Тестовое задание

Реализовать RESTful API для управления исполнителями и заказами.

Общая концепция: есть компании, у которых есть менеджеры и исполнители, менеджеры создают заказы, исполнители их выполняют.
Создавая API, необходимо придерживаться лучших практик Laravel, применяя паттерны разработки, наиболее подходящие для средних/больших проектов с расчетом на масштабирование. Минимальный набор – Services + Repositories, но если вы примените более грамотный подход к организации архитектуры, то это будет только плюсом.
Бизнес-логика в контроллерах даже не рассматривается!

При проектировании эндпоинтов API необходимо строго придерживаться методологии REST.

## Что должно быть в API

1.	Laravel 8 или 11 (От выбора версии зависит сложность дальнейших задач)
2.	Аутентификация с использованием пакета Laravel Passport  
      a.	Установить пакет  
      b.	Создать таблицу и модель users (Если требуется). Это будут менеджеры.  
      c.	Обеспечить выдачу токенов при авторизации и отзыв токенов при выходе из системы  
      d.	Секретные ключи хранить в хэшируемом виде  
      e.	Переопределить маршруты пакета на следующие:  
      `POST	api/passport/token`  
      `POST	api/passport/token/refresh`  
      `GET	api/passport/tokens`  
      `DELETE	api/passport/tokens/{token_id}`  
      `GET	api/passport/clients`  
      `POST	api/passport/clients`  
      `PUT	api/passport/clients/{client_id}`  
      `DELETE	api/passport/clients/{client_id}`  
      `GET	api/passport/scopes`  
      `GET	api/passport/personal-access-tokens`  
      `POST	api/passport/personal-access-tokens`  
      `DELETE	api/passport/personal-access-tokens/{token_id}`  
      f.	Реализовать эндпоинт на просмотр всех активных сессий пользователя  
      g.	Реализовать эндпоинт на закрытие какой-либо из сессий  
3.	Написать миграции, самостоятельно выбрать наиболее оптимальные типы для полей и создать необходимые индексы для следующих таблиц:  
      a. partnerships (Компании, создающие заказы)  
      •	id  
      •	name  
      •	created_at  
      •	updated_at  
      b. orders (Таблица заказов)  
      •	id  
      •	type_id (Тип заказа из таблицы order_types)  
      •	partnership_id (Компания, от лица которой создан заказ)  
      •	user_id (Пользователь, создавший заказ)  
      •	description  
      •	date  
      •	address  
      •	amount  
      •	status (Создан, назначен исполнитель, завершен)  
      •	created_at  
      •	updated_at  
      c.	workers (Таблица исполнителей)  
      •	id  
      •	name  
      •	second_name  
      •	surname  
      •	phone  
      •	created_at  
      •	updated_at  
      d.	order_worker (Сводная таблица orders и workers)  
      •	order_id  
      •	worker_id  
      •	amount  
      •	created_at  
      •	updated_at  
      e.	order_types (Типы заказов). Наполнить таблицу типами заказов (Погрузка/Разгрузка, Такелажные работы, Уборка)  
      •	id  
      •	name  
      f.	workers_ex_order_types (Сводная таблица. Типы заказов, с которыми исполнитель не работает)  
      •	worker_id  
      •	order_type_id  
      •	created_at  
      •	updated_at  
      g.	Написать миграцию на добавление поля partnership_id в таблицу users.  
4.	Создать эндпоинт для создания заказа с необходимыми полями из таблицы orders  
5.	Написать сиды и/или фабрики для наполнения базы тестовыми данными.  
6.	Создать эндпоинт для назначения исполнителя на заказ. Написать валидацию на случай, если на заказ пытаются назначить исполнителя, который отказался от таких типов заказов. Например, исполнитель отказался от заказов с типом «Погрузка/разгрузка», а его пытаются назначить на заказ с типом «Погрузка/Разгрузка».  
7.	Написать фильтр для вывода исполнителей по заданным типам заказов. Эндпоинт должен принимать массив id типов заказов и отдавать тех исполнителей, у которых хотя бы один из типов заказов отсутствует в таблице workers_ex_order_types.  
      Например, исполнитель с id 2 отказался от типов заказов с id 4 и id 5. В фильтре я передаю массив с id типов заказов - 3, 4, 5, исполнитель должен попасть в выборку т.к. от типа заказа с id 3 он не отказывался. Если я передаю массив с id типов заказов 4, 5, сотрудник не должен попасть в выборку т.к. от обоих типов заказов он отказался.  
      В реализации этого фильтра необходимо использовать построитель запросов Eloquent.

## Дополнительно

Выполнение этого пункта необязательно, но будет преимуществом среди других кандидатов!

Создать эндпоинт на обновление статуса заказа. Например, проставление статуса «Завершен». Важно, чтобы статус заказа транслировался пользователю, назначенному на заказ, по протоколу WebSockets с использованием приватного канала.

Примечание. Если вы выбрали Laravel 8 то использовать пакет beyondcode/laravel-websockets. Если вы выбрали Laravel 11 то использовать пакет laravel/reverb.

Написать Feature тесты для каждого эндпоинты (Кроме, Passport).

## Примечание

Написать файл ReadMe.md с последовательными действиями по установке проекта и списком эндпоинтов для проверки. Можете использовать swagger, если хотите.

К выполнению обязательны все пункты, кроме раздела «Дополнительно».

Для выполнения задач можете использовать пакеты, которые вам удобны.
